<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ORIA – Assistant en santé féminine</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #07060a;
      --bg2:#0b0712;

      --glass: rgba(255,255,255,.055);
      --glass2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.12);

      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --muted2: rgba(255,255,255,.56);

      --pink: #ff2d86;
      --pink2: #b36bff;
      --mint: #20e3a6;

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 10px 30px rgba(0,0,0,.35);

      --r: 18px;
      --r2: 24px;
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; margin:0; }
    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      overflow-x:hidden;
    }

    /* Animated mesh background */
    .mesh{
      position: fixed;
      inset: -20vh -10vw;
      z-index: -1;
      background:
        radial-gradient(600px 480px at 18% 18%, rgba(255,45,134,.22), transparent 60%),
        radial-gradient(620px 520px at 80% 22%, rgba(179,107,255,.18), transparent 62%),
        radial-gradient(720px 520px at 70% 78%, rgba(255,45,134,.12), transparent 60%),
        radial-gradient(680px 520px at 28% 80%, rgba(179,107,255,.10), transparent 58%),
        radial-gradient(1200px 900px at 50% 50%, rgba(255,255,255,.03), transparent 65%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      filter: blur(0px) saturate(1.05);
      animation: floaty 14s ease-in-out infinite alternate;
    }
    @keyframes floaty{
      0%{ transform: translate3d(0,0,0) scale(1); }
      100%{ transform: translate3d(-18px, 12px, 0) scale(1.02); }
    }

    a{ color: inherit; text-decoration: none; cursor: pointer; }

    .wrap{
      width: min(1180px, calc(100% - 28px));
      margin: 0 auto;
    }

    /* Header */
    header{
      position: sticky;
      top:0;
      z-index: 30;
      backdrop-filter: blur(14px);
      background: linear-gradient(to bottom, rgba(7,6,10,.78), rgba(7,6,10,.40));
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      padding: 14px 0;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width: 220px;
    }

    .core{
      width: 44px;
      height: 44px;
      border-radius: 999px;
      position: relative;
      background:
        radial-gradient(14px 14px at 30% 28%, rgba(255,255,255,.92), rgba(255,255,255,0) 62%),
        radial-gradient(40px 40px at 55% 55%, rgba(255,45,134,.95), rgba(179,107,255,.22) 56%, rgba(255,45,134,0) 74%),
        rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 16px 44px rgba(255,45,134,.14);
      overflow:hidden;
    }
    .core:after{
      content:"";
      position:absolute;
      inset:-18px;
      background:
        radial-gradient(120px 60px at 30% 30%, rgba(255,45,134,.20), transparent 60%),
        radial-gradient(120px 60px at 70% 70%, rgba(179,107,255,.14), transparent 60%);
      filter: blur(4px);
      opacity:.9;
      animation: corePulse 4.4s ease-in-out infinite;
    }
    @keyframes corePulse{
      0%,100%{ transform: scale(1); opacity:.75; }
      50%{ transform: scale(1.08); opacity:1; }
    }

    .brandTitle h1{ margin:0; font-size: 14px; font-weight: 900; letter-spacing: .2px; }
    .brandTitle p{ margin:0; font-size: 12px; color: var(--muted2); }

    .navlinks{ display:flex; align-items:center; gap: 10px; flex: 1; justify-content:center; }
    .navlinks a{
      font-size: 13px;
      color: rgba(255,255,255,.76);
      padding: 10px 12px;
      border-radius: 999px;
      transition: background 0.2s;
    }
    .navlinks a:hover{ background: rgba(255,255,255,.06); color: #fff; }

    .cta{ display:flex; align-items:center; gap: 10px; justify-content:flex-end; min-width: 220px; }
    .pill{ padding: 10px 14px; border-radius: 999px; border: 1px solid rgba(255,255,255,.1); background: rgba(255,255,255,.05); font-size: 13px; }

    .btn{
      display:inline-flex; align-items:center; justify-content:center; padding: 11px 16px;
      border-radius: 999px; border: 1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.06);
      color: #fff; font-weight: 800; font-size: 13px; cursor: pointer; transition: 0.2s;
    }
    .btn-primary{ background: linear-gradient(135deg, var(--pink), #ff1d6d); border: none; box-shadow: 0 18px 40px rgba(255,45,134,.18); }
    .btn-primary:hover{ transform: scale(1.02); }

    /* Bento grid */
    .bento{ display:grid; grid-template-columns: 1.55fr .9fr; gap: 16px; margin-top: 14px; }
    .card{ border: 1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.05); border-radius: var(--r2); backdrop-filter: blur(16px); position: relative; overflow: hidden; }
    .cardGlow:before{
      content:""; position:absolute; inset:-80px -80px auto auto; width: 260px; height: 260px;
      background: radial-gradient(circle, rgba(255,45,134,.3), transparent 70%); filter: blur(2px); pointer-events:none;
    }
    .cardPad{ padding: 18px; }

    .heroTitle{ font-size: clamp(26px, 3vw, 38px); line-height: 1.05; font-weight: 950; margin: 12px 0 10px; }
    .heroSub{ color: var(--muted); font-size: 14px; line-height: 1.65; }

    .miniTitle{ font-size: 13px; font-weight: 900; margin: 0; }
    .miniText{ margin: 8px 0 0; color: var(--muted); font-size: 12px; line-height: 1.55; }
    .divider{ height:1px; background: rgba(255,255,255,.08); margin: 14px 0; }

    /* Chips */
    .chips{ display:flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    .chip{ border: 1px solid rgba(255,255,255,.1); background: rgba(255,255,255,.05); color: #fff; padding: 8px 12px; border-radius: 999px; font-size: 12px; cursor: pointer; }
    .chip:hover{ background: rgba(255,255,255,.1); }

    /* Chat logic */
    .chatShell{ min-height: 610px; display:flex; flex-direction: column; }
    .chatTop{ display:flex; align-items:center; justify-content:space-between; padding: 14px; border-bottom: 1px solid rgba(255,255,255,.08); background: rgba(255,255,255,.03); }
    .chatTopLeft{ display:flex; align-items:center; gap: 10px; }
    .aiPulse{ width: 12px; height: 12px; border-radius: 50%; background: var(--mint); box-shadow: 0 0 10px var(--pink); animation: breathe 3s infinite; }
    @keyframes breathe{ 0%,100%{opacity: 0.5; transform: scale(1);} 50%{opacity: 1; transform: scale(1.2);} }
    .chatBody{ padding: 14px; overflow-y: auto; flex:1; display:flex; flex-direction: column; gap: 12px; }
    .bubble{ max-width: 85%; padding: 12px; border-radius: 18px; font-size: 13px; line-height: 1.5; border: 1px solid rgba(255,255,255,.1); }
    .bubble.me{ align-self: flex-end; background: linear-gradient(135deg, rgba(255,45,134,0.2), rgba(179,107,255,0.1)); border-color: rgba(255,45,134,0.3); }
    .bubble.bot{ align-self: flex-start; background: rgba(255,255,255,0.05); }
    .chatBottom{ padding: 14px; border-top: 1px solid rgba(255,255,255,0.08); background: rgba(0,0,0,0.2); }
    .inputWrap{ display:flex; gap: 10px; }
    textarea{ flex:1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #fff; padding: 10px; resize: none; outline: none; }
    .hint{ font-size: 11px; color: var(--muted2); margin-top: 8px; }

    /* MODAL STYLING (THE KEY TO FLUIDITY) */
    .modal {
      display: none; 
      position: fixed;
      z-index: 1000;
      inset: 0;
      background: rgba(7, 6, 10, 0.7);
      backdrop-filter: blur(15px);
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .modal.active { display: flex; opacity: 1; }
    .modal-content {
      background: #0f0c18;
      border: 1px solid var(--stroke);
      border-radius: var(--r2);
      width: min(600px, 92%);
      max-height: 85vh;
      overflow-y: auto;
      padding: 40px 30px;
      position: relative;
      transform: translateY(30px);
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      box-shadow: 0 40px 100px rgba(0,0,0,0.8);
    }
    .modal.active .modal-content { transform: translateY(0); }
    .close-modal {
      position: absolute; top: 20px; right: 20px; cursor: pointer;
      font-size: 24px; color: var(--muted2); transition: 0.2s;
    }
    .close-modal:hover { color: #fff; transform: rotate(90deg); }

    /* Loading dots */
    .loadingDots{ display:flex; gap: 4px; }
    .dot{ width: 5px; height: 5px; background: #fff; border-radius: 50%; animation: bounce 1.4s infinite; }
    .dot:nth-child(2){ animation-delay: 0.2s; }
    .dot:nth-child(3){ animation-delay: 0.4s; }
    @keyframes bounce{ 0%, 100%{ transform: translateY(0); } 50%{ transform: translateY(-5px); } }

    @media (max-width: 980px){
      .navlinks{ display:none; }
      .bento{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="mesh" aria-hidden="true"></div>

  <header>
    <div class="wrap">
      <div class="nav">
        <div class="brand">
          <div class="core" aria-hidden="true"></div>
          <div class="brandTitle">
            <h1>ORIA</h1>
            <p>Assistant santé féminine</p>
          </div>
        </div>

        <nav class="navlinks" aria-label="Navigation">
          <a onclick="closeAllModals()">Chat</a>
          <a onclick="openModal('modal-guides')">Guides</a>
          <a onclick="openModal('modal-aide')">Aide</a>
        </nav>

        <div class="cta">
          <span class="pill" id="localTimePill">--:--</span>
          <button class="btn btn-primary" id="btnFocus">Parler</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <section class="bento">
        <section class="card chatShell" id="chat">
          <div class="chatTop">
            <div class="chatTopLeft">
              <span class="aiPulse"></span>
              <div class="chatTopTitle">
                <strong>ORIA</strong>
                <span id="statusText" style="font-size: 11px; opacity: 0.7;">En ligne</span>
              </div>
            </div>
            <button class="btn" id="btnClear" style="padding: 6px 12px; font-size: 11px;">Effacer</button>
          </div>

          <div class="chatBody" id="chatBody"></div>

          <div class="chatBottom">
            <div class="inputWrap">
              <textarea id="message" placeholder="Posez votre question ici..." rows="1"></textarea>
              <button class="btn btn-primary" id="send">Envoyer</button>
            </div>
            <div class="hint"><strong>ORIA :</strong> Informations générales uniquement. Pas de diagnostic.</div>
            <div id="latency" style="font-size: 9px; opacity: 0.4; margin-top: 4px;"></div>
          </div>
        </section>

        <aside class="stack">
          <section class="card cardGlow cardPad">
            <h2 class="heroTitle">Écoutez votre corps.</h2>
            <p class="heroSub">ORIA vous aide à décrypter vos cycles et symptômes hormonaux en toute sécurité.</p>
            <div class="divider"></div>
            <h3 class="miniTitle">Urgences</h3>
            <p class="miniText">Douleur intense ou malaise ?<br>Appelez le <strong>15</strong> ou le <strong>112</strong>.</p>
          </section>

          <section class="card cardPad">
            <h3 class="miniTitle">Sujets suggérés</h3>
            <div class="chips" id="chips">
              <button class="chip" data-text="J’ai un retard de règles, que faire ?">Retard de règles</button>
              <button class="chip" data-text="Douleurs pelviennes : quand s'inquiéter ?">Douleurs pelviennes</button>
              <button class="chip" data-text="J'ai oublié ma pilule hier soir.">Oubli de pilule</button>
            </div>
          </section>
        </aside>
      </section>
    </div>
  </main>

  <div id="modal-guides" class="modal" onclick="closeAllModals()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <span class="close-modal" onclick="closeAllModals()">&times;</span>
      <h2 class="heroTitle" style="font-size: 28px;">Guides d'utilisation</h2>
      <div class="divider"></div>
      <h3 class="miniTitle">Parler à l'IA</h3>
      <p class="miniText">Soyez précise : mentionnez la durée du symptôme et son intensité. ORIA est conçue pour l'orientation, pas pour le diagnostic final.</p>
      
      <h3 class="miniTitle" style="margin-top:20px;">Préparer son rendez-vous</h3>
      <p class="miniText">Vous pouvez utiliser les réponses d'ORIA pour lister vos questions à poser à votre gynécologue ou sage-femme.</p>
      <br>
      <button class="btn" onclick="closeAllModals()" style="width: 100%;">J'ai compris</button>
    </div>
  </div>

  <div id="modal-aide" class="modal" onclick="closeAllModals()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <span class="close-modal" onclick="closeAllModals()">&times;</span>
      <h2 class="heroTitle" style="font-size: 28px;">Centre d'aide</h2>
      <div class="divider"></div>
      <h3 class="miniTitle">Confidentialité</h3>
      <p class="miniText">Vos messages sont traités de manière anonyme. Nous ne stockons aucune information permettant de vous identifier personnellement.</p>
      
      <h3 class="miniTitle" style="margin-top:20px;">Technique</h3>
      <p class="miniText">Si l'assistant ne répond pas, vérifiez votre connexion ou réessayez dans quelques minutes. Développé par RedDrop Lab.</p>
      <br>
      <button class="btn" onclick="closeAllModals()" style="width: 100%;">Fermer</button>
    </div>
  </div>

  <script>
    const BACKEND_URL = "https://medical-chatbot-production-af8e.up.railway.app";
    const chatBody = document.getElementById("chatBody");
    const inputEl = document.getElementById("message");
    const sendBtn = document.getElementById("send");
    const btnClear = document.getElementById("btnClear");
    const btnFocus = document.getElementById("btnFocus");
    const localTimePill = document.getElementById("localTimePill");

    // MODAL LOGIC
    function openModal(id) {
      document.getElementById(id).classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function closeAllModals() {
      document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
      document.body.style.overflow = 'auto';
    }
    document.addEventListener('keydown', (e) => { if (e.key === "Escape") closeAllModals(); });

    // CHAT LOGIC
    function escapeHtml(s){ return (s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
    
    function addBubble(role, text){
      const b = document.createElement("div");
      b.className = "bubble " + (role === "me" ? "me" : "bot");
      b.innerHTML = escapeHtml(text);
      chatBody.appendChild(b);
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    async function send(){
      const msg = inputEl.value.trim();
      if(!msg) return;
      addBubble("me", msg);
      inputEl.value = "";
      
      // Loading
      const loader = document.createElement("div");
      loader.className = "bubble bot";
      loader.innerHTML = '<div class="loadingDots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
      chatBody.appendChild(loader);
      chatBody.scrollTop = chatBody.scrollHeight;

      try {
        const res = await fetch(BACKEND_URL + "/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg })
        });
        const data = await res.json();
        loader.remove();
        addBubble("bot", data.answer || "Désolé, une erreur est survenue.");
        if(data.latency_ms) document.getElementById("latency").textContent = `Réponse en ${data.latency_ms}ms`;
      } catch(e) {
        loader.remove();
        addBubble("bot", "Erreur de connexion au serveur.");
      }
    }

    // Handlers
    sendBtn.addEventListener("click", send);
    btnClear.addEventListener("click", () => { chatBody.innerHTML = ""; addBubble("bot", "Historique effacé. Comment puis-je vous aider ?"); });
    btnFocus.addEventListener("click", () => inputEl.focus());
    inputEl.addEventListener("keydown", (e) => { if(e.key === "Enter" && !e.shiftKey) { e.preventDefault(); send(); }});

    // Chips
    document.getElementById("chips").addEventListener("click", (e) => {
      if(e.target.classList.contains("chip")) {
        inputEl.value = e.target.getAttribute("data-text");
        inputEl.focus();
      }
    });

    // Clock
    setInterval(() => {
      const d = new Date();
      localTimePill.textContent = d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }, 1000);

    // Init
    addBubble("bot", "Bonjour, je suis ORIA. Je suis là pour répondre à vos questions sur la santé féminine.");
  </script>
</body>
</html>